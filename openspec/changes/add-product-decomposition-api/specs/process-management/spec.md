# Capability: Process Management

> **Change Type**: MODIFIED
>
> **Capability ID**: process-management
>
> **Description**: This capability enables users to define and manage Process objects that transform inputs into outputs, now with automatic process detection from external data sources.

---

## ADDED Requirements

### Requirement: Auto-detect processes from external API data

**Unique ID**: `process-mgmt-auto-detect-1`

When importing product data that includes manufacturing steps or processing information, the system MUST automatically create Process objects.

#### Scenario: Detect food processing from NOVA classification

**GIVEN** the user imports a product from OpenFoodFacts
**AND** the product has a NOVA group classification (e.g., "Ultra-processed foods and drinks")
**WHEN** the import wizard displays the decomposition tree
**THEN** the system creates a Process object with type="Food Processing"
**AND** the Process includes a description derived from NOVA definition
**AND** links the raw ingredients (inputs) to the final product (output)

#### Scenario: Detect manufacturing steps from WikiFab recipe

**GIVEN** the user imports a DIY product from WikiFab (e.g., "Homemade soap")
**AND** the WikiFab article includes structured steps (Step 1: Mix oils, Step 2: Add lye, Step 3: Cure)
**WHEN** the transformation process parses the data
**THEN** the system creates a Process object for each step
**AND** links the processes sequentially (Step 1 output â†’ Step 2 input)
**AND** populates the Process.description with the step instructions

#### Scenario: Detect assembly process from OSHWA BOM

**GIVEN** the user imports hardware from OSHWA (e.g., "Arduino-based sensor")
**AND** the OSHWA data includes a BOM (bill of materials)
**WHEN** the transformation creates a decomposition tree
**THEN** the system creates a Process object with type="Assembly"
**AND** lists all BOM components as inputs (InputInstance objects)
**AND** links the final hardware product as the output

---

### Requirement: Link external process data to Process objects

**Unique ID**: `process-mgmt-link-external-1`

Process objects created from external sources MUST include provenance metadata linking back to the original data source.

#### Scenario: Store OpenLCA process metadata

**GIVEN** the user imports a product from OpenLCA Nexus (e.g., "Steel production, converter, unalloyed")
**WHEN** the system creates a Process object for steel production
**THEN** the Process includes an `externalSources` array with:

- `source: "OpenLCA"`
- `id: "<OpenLCA dataset UUID>"`
- `url: "<OpenLCA Nexus link>"`
- `confidence: <calculated score based on data completeness>`
- `fetchedAt: <ISO timestamp>`
  **AND** the Process.inputs are populated from OpenLCA quantified inputs (iron ore, coal, energy)
  **AND** the Process.impacts are populated from OpenLCA environmental impact data

---

### Requirement: Allow recursive decomposition of process inputs

**Unique ID**: `process-mgmt-recursive-decomp-1`

Users MUST be able to recursively decompose any input of a Process by importing data for that input's ProductInstance.

#### Scenario: Decompose a food ingredient into its agricultural process

**GIVEN** a FoodInstance "Chocolate Bar" with an input "Cocoa Powder"
**AND** "Cocoa Powder" is an InputInstance with quantity=50g
**WHEN** the user expands "Cocoa Powder" in the decomposition tree view
**AND** clicks "Import Sources for Cocoa Powder"
**THEN** the system queries external APIs for cocoa powder production
**AND** creates a Process object for cocoa processing (fermentation, drying, roasting, grinding)
**AND** creates InputInstance objects for cocoa beans, sugar, etc.
**AND** nests this sub-tree under the original "Cocoa Powder" input

#### Scenario: Stop recursion at depth limit

**GIVEN** the user has configured a max decomposition depth of 3 levels
**AND** the current decomposition tree is already 3 levels deep
**WHEN** the user attempts to expand a node at level 3
**THEN** the system displays "Maximum depth reached" message
**AND** does NOT query external APIs for deeper decomposition
**AND** provides a link to "View this component as a standalone product" (opens in new editor)

---

## MODIFIED Requirements

### Requirement: Create Process objects

**Unique ID**: `process-mgmt-create-1` _(existing requirement, being modified)_

Users MUST be able to create Process objects either manually or automatically from external API data during product import.

**Changes**:

- ADDED: Processes can be auto-generated from external API data
- ADDED: Auto-generated processes are marked with `autoGenerated: true` flag
- MODIFIED: Manual process creation remains default; auto-generation is triggered by import

#### Scenario: Create Process manually (unchanged)

**GIVEN** the user clicks "Add Process"
**WHEN** the user fills out the process details (type, description, inputs, outputs, impacts)
**THEN** the system creates a Process object
**AND** no external sources are involved

#### Scenario: Create Process from imported data (new)

**GIVEN** the user imports a product with manufacturing steps from WikiFab
**WHEN** the transformation detects process information in the external data
**THEN** the system auto-creates Process objects
**AND** marks them with `autoGenerated: true`
**AND** links them to the imported ProductInstance
**AND** allows the user to review and edit before final acceptance

---

### Requirement: Edit Process details

**Unique ID**: `process-mgmt-edit-1` _(existing requirement, being modified)_

Users MUST be able to edit Process details, including auto-generated processes, with manual edits taking precedence over future imports.

**Changes**:

- ADDED: Auto-generated processes can be edited like manual processes
- ADDED: Editing an auto-generated process removes the `autoGenerated` flag
- ADDED: Users can re-import process data from external sources

#### Scenario: Edit auto-generated Process (new)

**GIVEN** a Process was auto-generated from OpenLCA data
**WHEN** the user edits the Process description
**THEN** the system updates the description
**AND** sets `autoGenerated: false` (marking it as manually edited)
**AND** future re-imports do NOT overwrite this Process unless explicitly requested
